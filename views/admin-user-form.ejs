<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= mode === 'edit' ? 'Edit Person' : 'Add Person' %></title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <main>
        <div class="hero-section">
            <nav class="hero-nav">
                <div class="hero-nav-left">
                    <a href="/">Only Good News</a>
                </div>
                <div class="hero-nav-right">
                    <% if (username) { %>
                        <a href="/preferences" class="hero-nav-link">Preferences</a>
                        <a href="/saved" class="hero-nav-link">Saved</a>
                        <% if (isAdmin) { %>
                            <a href="/admin/users" class="hero-nav-link">Manage Users</a>
                        <% } %>
                        <span class="hero-nav-user">Signed in as <%= username %></span>
                        <form action="/logout" method="POST" class="hero-nav-form">
                            <button type="submit" class="btn subtle">Logout</button>
                        </form>
                    <% } else { %>
                        <a href="/preferences" class="hero-nav-link">Preferences</a>
                        <a href="/login" class="hero-nav-link">Login</a>
                        <a class="btn primary" href="/signup">Sign up</a>
                    <% } %>
                </div>
            </nav>
            <div class="hero-content">
                <img class="logo" src="/images/logo.png" alt="Only Good News Logo">
                <h1 class="hero-title"><%= mode === 'edit' ? 'Edit Person' : 'Add Person' %></h1>
                <p class="hero-subtitle">Manage user and person details.</p>
            </div>
        </div>

        <div class="container">
        <div class="card">
            <div class="admin-header">
                <div>
                    <h1><%= mode === 'edit' ? 'Edit Person' : 'Add Person' %></h1>
                    <p class="muted">Manage user and person details.</p>
                </div>
                <a class="btn" href="/admin/users">‚Üê Back to list</a>
            </div>

            <% if (error) { %>
                <div class="alert error"><%= error %></div>
            <% } %>

            <form class="admin-form" action="<%= mode === 'edit' ? '/admin/users/' + values.person_id : '/admin/users' %>" method="POST">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            value="<%= values.username || '' %>"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="first_name">First name</label>
                        <input
                            type="text"
                            id="first_name"
                            name="first_name"
                            value="<%= values.first_name || '' %>">
                    </div>
                    <div class="form-group">
                        <label for="last_name">Last name</label>
                        <input
                            type="text"
                            id="last_name"
                            name="last_name"
                            value="<%= values.last_name || '' %>">
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input
                            type="text"
                            id="city"
                            name="city"
                            value="<%= values.city || '' %>">
                    </div>
                    <div class="form-group">
                        <label for="state">State/Province</label>
                        <select id="state" name="state">
                            <option value="">Select state</option>
                            <% [
                                ['AL','AL'],['AK','AK'],['AZ','AZ'],['AR','AR'],['CA','CA'],
                                ['CO','CO'],['CT','CT'],['DE','DE'],['FL','FL'],['GA','GA'],
                                ['HI','HI'],['ID','ID'],['IL','IL'],['IN','IN'],['IA','IA'],
                                ['KS','KS'],['KY','KY'],['LA','LA'],['ME','ME'],['MD','MD'],
                                ['MA','MA'],['MI','MI'],['MN','MN'],['MS','MS'],['MO','MO'],
                                ['MT','MT'],['NE','NE'],['NV','NV'],['NH','NH'],['NJ','NJ'],
                                ['NM','NM'],['NY','NY'],['NC','NC'],['ND','ND'],['OH','OH'],
                                ['OK','OK'],['OR','OR'],['PA','PA'],['RI','RI'],['SC','SC'],
                                ['SD','SD'],['TN','TN'],['TX','TX'],['UT','UT'],['VT','VT'],
                                ['VA','VA'],['WA','WA'],['WV','WV'],['WI','WI'],['WY','WY']
                            ].forEach(([code,label]) => { %>
                                <option value="<%= code %>" <%= (values.state || '').toUpperCase() === code ? 'selected' : '' %>><%= label %></option>
                            <% }); %>
                            <option value="OTHER" <%= (values.state || '') === 'OTHER' ? 'selected' : '' %>>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="country">Country</label>
                        <select id="country" name="country">
                            <option value="">Select country</option>
                            <% [
                                'USA','Canada','Mexico','United Kingdom','Ireland','Germany','France','Spain','Italy',
                                'Netherlands','Belgium','Sweden','Norway','Denmark','Finland','Switzerland','Austria',
                                'Australia','New Zealand','India','China','Japan','South Korea','Singapore','Philippines',
                                'Brazil','Argentina','Chile','Colombia','South Africa','Nigeria','Kenya','Egypt','Israel',
                                'United Arab Emirates','Saudi Arabia','Turkey','Other'
                            ].forEach((country) => { %>
                                <option value="<%= country %>" <%= (values.country || '') === country ? 'selected' : '' %>><%= country %></option>
                            <% }); %>
                        </select>
                    </div>
                    <%
                        const categories = [
                            'Arts, Culture and Entertainment',
                            'Crime, Law and Justice',
                            'Disaster and Accident',
                            'Economy, Business and Finance',
                            'Education',
                            'Environment',
                            'Health',
                            'Human Interest',
                            'Labor',
                            'Lifestyle and Leisure',
                            'Politics',
                            'Religion and Belief',
                            'Science and Technology',
                            'Social Issue',
                            'Sport',
                            'War, Conflict and Unrest',
                            'Weather'
                        ];
                    %>
                    <div class="form-group">
                        <label for="preference_one">Preference 1</label>
                        <select id="preference_one" name="preference_one">
                            <option value="">-- Select a category --</option>
                            <% categories.forEach(cat => { %>
                                <option value="<%= cat %>" <%= values.preference_one === cat ? 'selected' : '' %>><%= cat %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="preference_two">Preference 2</label>
                        <select id="preference_two" name="preference_two">
                            <option value="">-- Select a category --</option>
                            <% categories.forEach(cat => { %>
                                <option value="<%= cat %>" <%= values.preference_two === cat ? 'selected' : '' %>><%= cat %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="preference_three">Preference 3</label>
                        <select id="preference_three" name="preference_three">
                            <option value="">-- Select a category --</option>
                            <% categories.forEach(cat => { %>
                                <option value="<%= cat %>" <%= values.preference_three === cat ? 'selected' : '' %>><%= cat %></option>
                            <% }); %>
                        </select>
                    </div>
                </div>

                <div class="form-grid two-col">
                    <div class="form-group">
                        <label for="password"><%= mode === 'edit' ? 'Password (leave blank to keep current)' : 'Password' %></label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            minlength="8"
                            <%= mode === 'create' ? 'required' : '' %>>
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">Confirm password</label>
                        <input
                            type="password"
                            id="confirm_password"
                            name="confirm_password"
                            minlength="8"
                            <%= mode === 'create' ? 'required' : '' %>>
                    </div>
                </div>

                <div class="admin-form-actions">
                    <button type="submit" class="btn primary"><%= mode === 'edit' ? 'Save changes' : 'Create user' %></button>
                    <a class="btn subtle" href="/admin/users">Cancel</a>
                </div>
            </form>
        </div>
        </div>
    </main>
</body>
</html>

